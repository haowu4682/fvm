\section{Details of \Sys Daemon}
\label{s:daemon}

This section will talk about some details of the \sys daemon. \Sys daemon is the
core component of \sys. Figure \ref{f:command-daemon}\hw{TODO write a table} depicts all the commands
that a \sys daemon could execute. Most commands of \sys are just a trivial call
of the underlying \git database. The partial checkout and partial commit are the
most important commands of \sys daemon.

\subsection{Protocol}
\HP{Consider merge this subsection with the overview.}

As previously said\HP{Check section 1 and 3 for whether this has been said.},
the client and server only talk on the control level. The data level is
transmitted using an underlying distributed file system. This design reduces the
complexity of \sys from trying to design a communication protocol for the data.
There are also deficiencies for the design. \hw{TODO talk about deficiencies.}

\hw{What else can we say here?}

\subsection{Partial checkout}

\include{fig-pcode-checkout}

Figure \ref{f:pcode-checkout} depicts the pseudo code for partial checkout.
Basically the process has two steps: the first step is to search for a user
specified relative path, and the second step is to retrieve files starting from
that point. \hw{The reason to divide the process into two steps is to save the
cost to traverse the files the user is not intereseted in.}

\subsection{Partial commit}

\hw{This subsection is similar to the previous one since the mechanisms are
similar, we will write it later.}

